<?xml version="1.0"?>
<odoo>
    <data>

        <!-- CRM Stages -->
        <function model="crm.stage" name="rename_crm_stages"/>

        <!-- CRM Opportunities Form View -->
        <record id="view_crm_opportunity_rem_unit_form" model="ir.ui.view">
            <field name="name">crm.lead.rem.unit.inherit</field>
            <field name="model">crm.lead</field>
            <field name="inherit_id" ref="crm.crm_case_form_view_oppor"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='tag_ids']" position="after">
                    <field name="re_reason"/>
                </xpath>
                <xpath expr="//div[@name='button_box']" position="inside">
	                <button class="oe_stat_button" type="object"
	                    name="action_stage_history" icon="fa-history" string="History">
	                </button>
	            </xpath>
                <xpath expr="//notebook/page[1]" position="before">
                	<page string="Searches for">
                		<div class="oe_button_box" name="button_box2">
		                	<button class="oe_stat_button" type="object"
			                    name="action_find_matching_units" icon="fa-search" string="Find Units">
			                </button>
		                </div>
		                <div name="unit_base_fields">
		                	<group>
			                	<group>
		                            <field name="re_offer_type_id"/>
	                            	<field name="re_type" widget="many2many_tags"/>
		                        </group>
		                        <group>
		                            <field name="re_city"/>
		                            <field name="re_is_new"/>
		                        </group>
	                        </group>
		                </div>
                	</page>
                	<page string="Unit Selection">
                        <field name="unit_ids" widget="many2many_kanban">
                            <kanban quick_create="false" create="true">
                                <field name="display_name"/>
                                <field name="main_img"/>
                                <templates>
                                    <t t-name="kanban-box">
                                        <div>
                                            <a t-if="! read_only_mode" type="delete" style="position: absolute; right: 0; padding: 4px; diplay: inline-block">X</a>
                                            <div class="oe_group_details" style="min-height: 40px">
                                                <img t-att-src="kanban_image('rem.unit', 'main_img', record.id.value)"
                                                     style="margin-right: 10px;max-width:140px"/><br/>
                                                <span><t t-esc="record.display_name.value"/></span>
                                            </div>
                                        </div>
                                    </t>
                                </templates>
                            </kanban>
                        </field>
                	</page>
                </xpath>
            </field>
        </record>
        
        <!--  Calendar Events Search View -->
	    <record id="view_rem_meeting_search" model="ir.ui.view">
	        <field name="name">REM - Meetings Search</field>
	        <field name="model">calendar.event</field>
	        <field name="inherit_id" ref="calendar.view_calendar_event_search"/>
	        <field name="arch" type="xml">
	            <xpath expr="//field[@name='user_id']" position="after">
	                <field name="unit_ids"/>
	            </xpath>
	        </field>
	    </record>

		<!--  Calendar Events Form View -->
	    <record model="ir.ui.view" id="view_calendar_event_form_rem_inherit">
	        <field name="name">calendar.event.rem.inherit</field>
	        <field name="model">calendar.event</field>
	        <field name="inherit_id" ref="calendar.view_calendar_event_form"/>
	        <field name="arch" type="xml">
		        <xpath expr="//page[1]" position="after">
		        <page string="Sales">
			        <group>
			        	<field name="opportunity_id" attrs="{'invisible': [('opportunity_id','=',False)]}"/>
			        	<field name="unit_ids" widget="many2many_tags"/>
			        </group>
		        </page>
		        </xpath>
	        </field>
	    </record>
	    
		<!--  Calendar Events popup Form View -->
	    <record model="ir.ui.view" id="view_calendar_event_popupform_rem_inherit">
	        <field name="name">calendar.event.popup.rem.inherit</field>
	        <field name="model">calendar.event</field>
	        <field name="inherit_id" ref="calendar.view_calendar_event_form_popup"/>
	        <field name="arch" type="xml">
		        <xpath expr="//group" position="after">
		        	<group>
		        		<group>
		        		<field name="opportunity_id" attrs="{'invisible': [('opportunity_id','=',False)]}"/>
		        		<field name="unit_ids" widget="many2many_tags" attrs="{'invisible': [('unit_ids','=',False)]}"/>
		        		</group>
		        	</group>
		        </xpath>
	        </field>
	    </record>
	    
    </data>
</odoo>

